<!DOCTYPE html>

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="main.css">
    <script type="text/javascript" src="jquery.js"></script>


    </script>
    <script type="text/javascript">
        $.ajax({
            type: "GET",
            url: "http://127.0.0.1:8080/api/countarticle",
            dataType: "text",
            success: function (data) {
                $("#numberofarticles").html(data + '<br />日志');
            }
        });
    </script>
    <script type="text/javascript">
        $.ajax({
            type: "GET",
            url: "http://127.0.0.1:8080/api/counttags",
            dataType: "text",
            success: function (data) {
                $("#indexspe").html(data + '<br />分类');
            }
        });
    </script>
    <script type="text/javascript">


        var i = 0;
        var tagcache = new Array;
        function addtag() {

            if (i < 6) {
                if ($('#tags-input' + i).val() !== "") {
                    
                    var cache = i
                    i = i + 1;
                    newtag[i] = `        
            <div id='addtags${i}' class='plustag'>
                <input id='tags-input${i}'  placeholder="标签">
                <div id='addtagbtn' onclick="addtag()">+</div>
                <div id='deletebtn' onclick="removetag(this.parentNode.id,${i})">-</div>
                
            </div>
            
            `


            
                    $('#addtags0').append(newtag[i])
                  
                    

                }
                else {

                    
                    alert("TAG不能为空")
                }


            }
            else { alert("标签数量过多"); }
        }

        

        function removetag(id) {
            
            $('#' + id).remove();

           
            
        }
        var newArticle
        var newtag = new Array;
        var cachearray=new Array;

        
        function save() {
            function checkarray(value){
                if (value !== "")
                {return value!==undefined}
                else alert("TAG不能为空")
            }
            
            var title = $("#title-input").val()
            var content = editor.txt.html();
            for (var p = 0; p <= i; p++) {
                cachearray[p] = $("#tags-input" + p).val()
                cachearray=cachearray.filter(checkarray);
            }

            if (title =="" || content ==""){
                alert("标题/内容不能为空")
            }
            else
            {newArticle = {
                "title": title,
                "content": content,
                "hashtags": cachearray
            }
            console.log(newArticle)
            $.ajax({
            type: "POST",
            async:false,
            data:newArticle,
            url: "http://127.0.0.1:8080/api/upload",
            dataType: "text",
            success: function (data) {
                alert("发送成功");
            },
            error:function(err){
                alert(err)
            }

        });

        }}




    </script>







</head>

<body style="background-color:rgb(175, 170, 170);">
    <div id='fullbody'>
        <aside>
            <div id="floattitle" class='frame'>
                <div id="logindiv">
                    <div id='loginspan'><span>注册/登录</span></div>

                </div>
                <div id="indexdiv">
                    <ul style="list-style:none">
                        <li>
                                <a href="/")>首页</a>
                        </li>
                        <li>
                                <a href="/tags.html")>标签</a>
                        </li>
                        <li>
                            归档
                        </li>
                    </ul>
                </div>
            </div>
            <div id="floatbottom" class='frame'>
                <div id='userprofile'>
                    <span>guitu</span>
                    <p>用实力让情怀落地</p>
                </div>
                <div id='indextable'>
                    <div class='table2' id='numberofarticles'>40<br />日志</div>
                    <div class='table2' id='indexspe'>40<br />日志</div>

                </div>
                <p>LINK</p>
                <a href="www.baidu.com">
                    百度
                </a>

            </div>
        </aside>

        <div id='postarea'>
            <div id='writearea'>
                <div><input id='title-input' placeholder="标题"></div>
                <div id='addtags0'>
                    <input id='tags-input0' placeholder="标签">
                    <div id='addtagbtn' onclick="addtag()">+</div>

                </div>
                <div id="editor">
                    <p>在这里输入正文</p>
                </div>

                <!-- 注意， 只需要引用 JS，无需引用任何 CSS ！！！-->
                <script type="text/javascript" src="node_modules/wangeditor/release/wangEditor.min.js"></script>
                <script type="text/javascript">
                    var E = window.wangEditor
                    var editor = new E('#editor')
                    // editor.txt.html('<p>在这里输入正文</p>')
                    editor.customConfig.showLinkImg = false
                    editor.customConfig.uploadImgServer = '/api/uploadimg'
                    editor.create()

                </script>

            </div>
            <div class='btn-show-article' id='btn-save-article' onclick='save()'>
                发送 》
            </div>
        </div>
</body>